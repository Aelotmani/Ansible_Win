---
- name: Create a temporary directory for MSBuildTools
  win_file:
    path: "{{ msbuild_dir_tmp }}"
    state: directory

- name: Copy MSBuildTools 14 installer from source server to target server (Temporaire will be replaced by Nexus)
  win_copy:
    src: "{{ msbuild_dir_src }}/buildtools_full_v14.exe"
    dest: "{{ msbuild_dir_tmp }}"
  register: file_copied

- name: Check if the MSBuildTools V14 installer exists
  win_stat:
      path: "{{ msbuild_dir_tmp }}\\{{ file_copied.original_basename }}"
  register: check_exec_file

- name: Install MSBuildTools V14 in progress ...
  win_shell: |
    try { 
        Start-Process `"{{ msbuild_dir_tmp }}\\buildtools_full_v14.exe`" -ArgumentList `
                    `"/quiet`", `
                    `"/full`", `
                    `"/noWeb`" `
                    -Wait
      write-Output "msbuild_installed"
      }catch{
      Write-Error $_.Exception.Message
      break
      }
  when: 
    - check_exec_file.stat.exists == True
